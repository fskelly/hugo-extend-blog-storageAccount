<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>
  
     Exchange Log File Monitoring Orchestration | 
    Fletcher&#39;s Tech Blog
  
</title><meta name="description" content="A day in the life of a Cloud Engineer."><meta name="author" content="Fletcher Kelly">

<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/favicon-32x32.png " sizes="32x32" type="image/png">
<link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0c344b">
<link rel="icon" href="/favicon.ico">


    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/themes/prism.min.css">
    



    
        
            <link rel="stylesheet" href="/dist/main.37ab3f61b95417873748.min.css">
        
    




<link rel="canonical" href="https://cloudadventures.fskelly.com/2012/12/06/exchange-log-file-monitoring-orchestration/"><meta property="og:title" content="Exchange Log File Monitoring Orchestration" />
<meta property="og:description" content="So what started this is actually quite simple. We have limited space on our virtual machines and the log files for IIS keeping filling up the drive on our Hub Transport Server (Exchange Server 2010). It is a little know fact, that a certain amount of free space on C: is needed on an Exchange Hub Transport Server, the magic number happens to be 15%. There are a few ways to solve the log file issue." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cloudadventures.fskelly.com/2012/12/06/exchange-log-file-monitoring-orchestration/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2012-12-06T11:41:28+00:00" />
<meta property="article:modified_time" content="2012-12-06T11:41:28+00:00" />

<meta itemprop="name" content="Exchange Log File Monitoring Orchestration">
<meta itemprop="description" content="So what started this is actually quite simple. We have limited space on our virtual machines and the log files for IIS keeping filling up the drive on our Hub Transport Server (Exchange Server 2010). It is a little know fact, that a certain amount of free space on C: is needed on an Exchange Hub Transport Server, the magic number happens to be 15%. There are a few ways to solve the log file issue."><meta itemprop="datePublished" content="2012-12-06T11:41:28+00:00" />
<meta itemprop="dateModified" content="2012-12-06T11:41:28+00:00" />
<meta itemprop="wordCount" content="730">
<meta itemprop="keywords" content="Exchange,IIS,Logs,Orchestration,Orchestrator,SCORCH," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Exchange Log File Monitoring Orchestration"/>
<meta name="twitter:description" content="So what started this is actually quite simple. We have limited space on our virtual machines and the log files for IIS keeping filling up the drive on our Hub Transport Server (Exchange Server 2010). It is a little know fact, that a certain amount of free space on C: is needed on an Exchange Hub Transport Server, the magic number happens to be 15%. There are a few ways to solve the log file issue."/>

</head>
<body>
    
<nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id="navbar-main-menu">
    <div class="container">
        <a class="navbar-brand font-weight-bold" href="https://cloudadventures.fskelly.com">Fletcher&#39;s Tech Blog</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-menu" aria-controls="main-menu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="main-menu">
            <ul class="navbar-nav ml-auto">
                
                    <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                
                    <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
                
            
            </ul>
        </div>
    </div>
</nav>


    
<main class="content-page container pt-7 pb-5">
    
    <div class="row">
        <div class="col">
            <article>
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="meta text-muted mb-3">
                            <p class="created text-muted text-uppercase font-weight-bold mb-1">December 6, 2012</p>
                            <span class="mr-2"><i class="fas fa-book-open mr-2"></i>730 words</span>
                            <span><i class="fas fa-clock mr-2"></i>4 mins read</span>
                        </div>

                        <h1>Exchange Log File Monitoring Orchestration</h1>

                        
                    </div>
                </div><div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="content">
                            <p><!-- raw HTML omitted -->So what started this is actually quite simple. We have limited space on our virtual machines and the log files for IIS keeping filling up the drive on our Hub Transport Server (Exchange Server 2010). It is a little know fact, that a certain amount of free space on C: is needed on an Exchange Hub Transport Server, the magic number happens to be 15%. There are a few ways to solve the log file issue. I found this <!-- raw HTML omitted --><a href="http://support.risualblogs.com/blog/2011/02/17/delete-iis-logs-after-certain-number-of-days-via-powershell/"><!-- raw HTML omitted -->solution<!-- raw HTML omitted --></a><!-- raw HTML omitted -->. This deletes all files older than 7 days. This can, of course, be modified to suit your needs, I personally have chosen 14 days. Some people choose more, it is basically a case of whatever works best for.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->I could simple set this a scheduled task and allow this to run every few days and keep the log files to a reasonable size. However, I have orchestrator and was thinking that this would be a great chance to get my hands dirty and start to show the benefit of Orchestrator to some of the staff in our IT department. I know those that know Orchestrator, are saying “you have to convince them how good Orchestrator is?” and the answer is a resounding “YES”. Anyways, back onto topic here. Below is a diagram of the orchestration. I will go into more detail around my thinking for each step. Hopefully someone can learn from this and help drive the value of System Centre Orchestrator <!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->So, the first bit is simply a monitor allowing you specify how often you would like the Runbook to Run.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image1.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><a href="/wp-content/uploads/2012/12/image2.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->Next up, is a simple “Disk Space” monitor found under “Monitoring”<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image3.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->I have configured the parameters as needed.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image4.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->I also tweaked the security parameters as needed to an account that has the required rights for checking Drive Space on the required server.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image5.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->For the next step, I modified the “Link Properties” to match my needs of checking of the Disk Space to return a value that will allow the rest of the Runbook to run. It is simply a case of Clicking “Add” and then selecting the required values to check for. I chose “Percentage of Space Available” from Component Before “is less than” Desired percentage.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image6.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->This is why I chose to create a runbook, my staff and Company like to be informed of any changes made on servers. So now I send an e-mail stating that the free space is low to the necessary recipients.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image7.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->Now, I create a folder to allow for creation of text files for the logging of which files will be deleted. (more on this later)<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image8.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->I also use published data from earlier in the Databus to create unique folders based on date and time.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image9.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->Now, I create a list of all the files to be deleted and read them into a “log file” and place them in the folder created above for “Auditing” purposes. I had to run this through a PowerShell script and there are some limitations with Orchestrator and Impersonating another account within PowerShell. I will continue to work on this to clean it up.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Please note that <em>subscribeddata</em> means data from earlier up the Databus, namely folder locations.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image10.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->I run the below PowerShell script.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->This reads the files to be deleted, older than 14 days, creates a log file, and reads the log file into the body of the e-mail.<!-- raw HTML omitted --></p>
<p>[sourcecode language=”powershell”]net use H: *subsribeddata* /user:europcar\administrator <!-- raw HTML omitted -->       $files=get-childitem -Path \ms-ec-exc01\C$\inetpub\logs\LogFiles -recurse | where-object {$_.lastwritetime -lt (get-date).addDays(-14)}| out-file -filepath &ldquo;H:\logs.txt&rdquo; -append<!-- raw HTML omitted -->$body = (get-content *subscribeddata&gt;*logs.txt -encoding ASCII | out-string)<!-- raw HTML omitted -->send-mailmessage -attachments <!-- raw HTML omitted -->\logs.txt -body $body -to &ldquo;<a href="mailto:fletcher.kelly@europcar.co.za">fletcher.kelly@europcar.co.za</a>&rdquo; -from &ldquo;<a href="mailto:orchestrator@europcar.co.za">orchestrator@europcar.co.za</a>&rdquo; -subject &ldquo;Files to be deleted&rdquo; -smtpserver 172.21.195.69<!-- raw HTML omitted -->net use h: /delete[/sourcecode]</p>
<p><!-- raw HTML omitted -->Now it is time to delete the actual files<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image11.png"><!-- raw HTML omitted --></a></p>
<p>[sourcecode language=”powershell”]net use H: *subsribeddata* /user:europcar\administrator *password*       $files=get-childitem -Path \ms-ec-exc01\C$\inetpub\logs\LogFiles -recurse | where-object {$_.lastwritetime -lt (get-date).addDays(-14)}| remove-item –recurse<!-- raw HTML omitted -->net use h: /delete[/sourcecode]</p>
<p><!-- raw HTML omitted -->Now it is time to check the Disk Space is at an adequate level.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image12.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->Modify the link Properties again to meet new requirements. So, I have tweaked the script to ensure that the free space is now above my threshold ( I have set mine to 15%)<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image13.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><a href="/wp-content/uploads/2012/12/image14.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->And then finally send an e-mail stating that the free space is now adequate. Tweaked to meet my needs with Subscribed data in the body and subject.<!-- raw HTML omitted --></p>
<p><a href="/wp-content/uploads/2012/12/image15.png"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted -->Please note that this information is provided as is. I can assist as much as possible. Please TEST, TEST and TEST again.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Hope this helps,<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->Follow me.<!-- raw HTML omitted --></p>
<p><a href="http://www.facebook.com/fletcher.kelly"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a><a href="http://twitter.com/#!/fskelly"><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></a></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>

                        </div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href="/tags/exchange">
                                    <i class="fas fa-tag mr-2"></i>Exchange
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/iis">
                                    <i class="fas fa-tag mr-2"></i>IIS
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/logs">
                                    <i class="fas fa-tag mr-2"></i>Logs
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/orchestration">
                                    <i class="fas fa-tag mr-2"></i>Orchestration
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/orchestrator">
                                    <i class="fas fa-tag mr-2"></i>Orchestrator
                                </a><a class="badge badge-pill badge-light border mr-2" href="/tags/scorch">
                                    <i class="fas fa-tag mr-2"></i>SCORCH
                                </a></div><ul class="share nav my-3 justify-content-end">
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fcloudadventures.fskelly.com%2f2012%2f12%2f06%2fexchange-log-file-monitoring-orchestration%2f&text=Exchange%20Log%20File%20Monitoring%20Orchestration">
              <i class="fa-fw fab fa-twitter"></i>
          </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fcloudadventures.fskelly.com%2f2012%2f12%2f06%2fexchange-log-file-monitoring-orchestration%2f&title=Exchange%20Log%20File%20Monitoring%20Orchestration">
                <i class="fa-fw fab fa-linkedin-in"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fcloudadventures.fskelly.com%2f2012%2f12%2f06%2fexchange-log-file-monitoring-orchestration%2f&t=Exchange%20Log%20File%20Monitoring%20Orchestration">
                <i class="fa-fw fab fa-facebook-f"></i>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" target="_blank" href="https://reddit.com/submit?url=https%3a%2f%2fcloudadventures.fskelly.com%2f2012%2f12%2f06%2fexchange-log-file-monitoring-orchestration%2f&title=Exchange%20Log%20File%20Monitoring%20Orchestration">
                <i class="fa-fw fab fa-reddit-alien"></i>
            </a>
        </li>
    </nav>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        
                    </div>
                </div><div class="row justify-content-center my-3">
                    <div class="col-lg-8">
                        <div id="commento"></div>
                        <script src="https://commento.io"></script>
                    </div>
                </div></article>
        </div>
    </div>

    <div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/2012/06/13/installing-system-centre-orchestrator/" class="d-block"><div class="card-body">
            <h4 class="card-title">Installing System Centre Orchestrator</h4>
            <p class="card-text text-muted text-uppercase">June 13, 2012</p>
            <div class="card-text">
                So, just recently I decided to install System Centre Orchestrator. It appears easy enough if you follow the Technet articles. This addresses the need for Service Accounts and the permissions needed by these accounts and there functions. It also helps you to size and decide the Orchestrator installation type that would best suit your environment. It helps you to decide the best way to break the components if you want to.
            </div>
        </div>
    </a>
</div>

            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/2012/08/13/dpm-and-exchange-mail-store-backup-failing/" class="d-block"><div class="card-body">
            <h4 class="card-title">DPM and Exchange Mail Store Backup failing</h4>
            <p class="card-text text-muted text-uppercase">August 13, 2012</p>
            <div class="card-text">
                
            </div>
        </div>
    </a>
</div>

            </div><div class="col mb-3">
                <div class="card h-100">
    
    <a href="/2011/09/01/documenting-the-environment/" class="d-block"><div class="card-body">
            <h4 class="card-title">Documenting the Environment</h4>
            <p class="card-text text-muted text-uppercase">September 1, 2011</p>
            <div class="card-text">
                Hi All,
It has been a really busy time for me. However, I am very happy with life at the moment. Just recently I received a “Microsoft Community Contributor” award from Microsoft.

I know I have been a little quite the last little while. I have been busy doing a job that everyone loves (I wish there was a font for sarcasm). I have been VERY busy documenting my production environment including Hyper-V, Active Directory and Exchange.
            </div>
        </div>
    </a>
</div>

            </div></div>
</main>


    <footer class="footer text-center bg-dark py-6">
    <div class="container">
        <div class="row">
            <div class="col">
                <ul class="list-inline">
                    <li class="list-inline-item"><a href="https://cloudadventures.fskelly.com/index.xml" rel="alternate" type="application/rss+xml" class="icons d-block">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a></li><li class="list-inline-item">
                            <a href="https://github.com/fskelly" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://linkedin.com/in/fletcherkelly" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li><li class="list-inline-item">
                            <a href="https://twitter.com/fskelly" class="icons d-block">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                </ul>

                <p class="text-muted">
                    
                        Copyright © 2013–2021, Fletcher Kelly; all rights reserved.
                    
                </p>

                <p class="text-muted">
                Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with <a href="https://github.com/puresyntax71/hugo-theme-chunky-poster" target="_blank">Chunky Poster</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

    
    
        
            <script src="/dist/main.d608eadfe5ac0688902e.min.js"></script>
        
    



<script>
    window.Prism = window.Prism || {};
    window.Prism.manual = true;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/plugins/autoloader/prism-autoloader.min.js"></script>







    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-XXXX', 'auto');
	
	ga('send', 'pageview');
}
</script>
</body>
</html>
