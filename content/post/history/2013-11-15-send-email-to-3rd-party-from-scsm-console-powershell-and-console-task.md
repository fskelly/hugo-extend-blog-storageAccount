---
title: Send Email to 3rd Party from SCSM Console â€“ PowerShell and Console Task
author: fskelly
type: post
date: 2013-11-15T11:58:48+00:00
url: /2013/11/15/send-email-to-3rd-party-from-scsm-console-powershell-and-console-task/
publicize_twitter_user:
  - fskelly
publicize_twitter_url:
  - http://t.co/h64LDWtZGE
publicize_linkedin_url:
  - 'http://www.linkedin.com/updates?discuss=&scope=51344436&stype=M&topic=5808503813715689472&type=U&a=3VKs'
categories:
  - Service Manager
tags:
  - Console
  - powershell
  - SCSM
  - SCSM 2012
  - Task

---
So recently, I had a customer ask me for the following as their previous incident management system had this functionality.

The customer wanted to be able to send an &#8220;Update Email&#8221; to a 3<sup>rd</sup> party from the SCSM Console with automatically placing the reference number into said email. They needed the functionality of sending to any email address. This was a requirement for the type of business they are in.

Please remember that I am by no means a developer. I was thinking of using System Centre Orchestrator, however for this simple requirement, I thought that it might be overkill. I am sure that in time, as the requirements grows and/or changes, System Centre Orchestrator will become a better fit. For this solution, I turned to my friend, [PowerShell][1]

I simply wanted to provide a clean interface for the customer to use. I follow a strict rule of KISS (Keep It Straight and Simple). With the PowerShell script, I provide two input fields.

  1. Email address of user for update to go to
  2. Update to be sent to customer.

The screenshot of what the window looks like

![][2] 

All of this was built in PowerShell with some from [Sapien PrimalForms Community Edition][3] to assist with the GUI part. The GUI is fully functional and tested. &#8220;Send Update&#8221; is responsible for sending the update to the specified person and the &#8220;Cancel&#8221; simply closes the form nicely and allows you to continue as normal.

PowerShell Code Below [(SendEmail &#8211; Technet Gallery Download)][4]

[code language=&#8221;powershell&#8221;]

#region Script Settings  
#<ScriptSettings xmlns="http://tempuri.org/ScriptSettings.xsd">  
\# <ScriptPackager>  
\# <process>powershell.exe</process>  
\# <arguments />  
\# <extractdir>%TEMP%</extractdir>  
\# <files />  
\# <usedefaulticon>true</usedefaulticon>  
\# <showinsystray>false</showinsystray>  
\# <altcreds>false</altcreds>  
\# <efs>true</efs>  
\# <ntfs>true</ntfs>  
\# <local>false</local>  
\# <abortonfail>true</abortonfail>  
\# <product />  
\# <version>1.0.0.1</version>  
\# <versionstring />  
\# <comments />  
\# <company />  
\# <includeinterpreter>false</includeinterpreter>  
\# <forcecomregistration>false</forcecomregistration>  
\# <consolemode>false</consolemode>  
\# <EnableChangelog>false</EnableChangelog>  
\# <AutoBackup>false</AutoBackup>  
\# <snapinforce>false</snapinforce>  
\# <snapinshowprogress>false</snapinshowprogress>  
\# <snapinautoadd>2</snapinautoadd>  
\# <snapinpermanentpath />  
\# <cpumode>1</cpumode>  
\# <hidepsconsole>false</hidepsconsole>  
\# </ScriptPackager>  
#</ScriptSettings>  
#endregion

param($ID)  
Import-Module &#8216;C:\Program Files\Common Files\SMLets\SMLets.psd1&#8217; -Force

#Generated Form Function  
function GenerateForm {  
########################################################################  
\# Code Generated By: SAPIEN Technologies PrimalForms (Community Edition) v1.0.10.0  
\# Generated On: 2013-11-14 09:08 AM  
\# Generated By: Fletcher  
########################################################################

#region Import the Assemblies  
[reflection.assembly]::loadwithpartialname("System.Windows.Forms") | Out-Null  
[reflection.assembly]::loadwithpartialname("System.Drawing") | Out-Null  
#endregion

#region Generated Form Objects  
$SendUpdateForm = New-Object System.Windows.Forms.Form  
$CancelButton = New-Object System.Windows.Forms.Button  
$SendUpdateButton = New-Object System.Windows.Forms.Button  
$UpdateTextBox = New-Object System.Windows.Forms.TextBox  
$UpdateLabel = New-Object System.Windows.Forms.Label  
$EmailToTextBox = New-Object System.Windows.Forms.TextBox  
$EMailToLabel = New-Object System.Windows.Forms.Label  
$InitialFormWindowState = New-Object System.Windows.Forms.FormWindowState  
#endregion Generated Form Objects

#&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-  
#Generated Event Script Blocks  
#&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-  
#Provide Custom Code for events specified in PrimalForms.  
$SendUpdateButton_OnClick=  
{  
Write-Host "Send Update"  
$to = $EmailToTextBox.Text  
Write-Host $to  
$from = "Servicedesk@bui.co.za"  
$emailbody = $UpdateTextBox.Text  
$subject = @"  
Update [ID]  
"@  
$body = @"  
$emailbody  
"@  
#$subject = "Update [ID]"  
#Write-Host $subject  
#Write-Host $body  
$smtpserver = "buiexc20.bui.co.za"  
#[string]$body = $UpdateTextBox.Text  
#$testcommand = "Send-MailMessage -To $to -From $from -Subject $messagencontent -Body &#8216;$body&#8217; -SmtpServer $smtpserver"  
Send-MailMessage -To $to -From $from -Subject $subject -Body $body -SmtpServer $smtpserver  
#Write-Host $testcommand  
$SendUpdateForm.Close()

}

$CancelButton_OnClick=  
{  
#TODO: Place custom script here  
$SendUpdateForm.Close()  
}

$OnLoadForm_StateCorrection=  
{#Correct the initial state of the form to prevent the .Net maximized form issue  
$SendUpdateForm.WindowState = $InitialFormWindowState  
}

#&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-  
#region Generated Form Code  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 323  
$System\_Drawing\_Size.Width = 409  
$SendUpdateForm.ClientSize = $System\_Drawing\_Size  
$SendUpdateForm.DataBindings.DefaultDataSourceUpdateMode = 0  
$SendUpdateForm.Name = "SendUpdateForm"  
$SendUpdateForm.Text = "Send Update"

$CancelButton.DataBindings.DefaultDataSourceUpdateMode = 0

$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 182  
$System\_Drawing\_Point.Y = 264  
$CancelButton.Location = $System\_Drawing\_Point  
$CancelButton.Name = "CancelButton"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 23  
$System\_Drawing\_Size.Width = 124  
$CancelButton.Size = $System\_Drawing\_Size  
$CancelButton.TabIndex = 5  
$CancelButton.Text = "Cancel"  
$CancelButton.UseVisualStyleBackColor = $True  
$CancelButton.add\_Click($CancelButton\_OnClick)

$SendUpdateForm.Controls.Add($CancelButton)

$SendUpdateButton.DataBindings.DefaultDataSourceUpdateMode = 0

$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 35  
$System\_Drawing\_Point.Y = 264  
$SendUpdateButton.Location = $System\_Drawing\_Point  
$SendUpdateButton.Name = "SendUpdateButton"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 23  
$System\_Drawing\_Size.Width = 116  
$SendUpdateButton.Size = $System\_Drawing\_Size  
$SendUpdateButton.TabIndex = 4  
$SendUpdateButton.Text = "Send Update"  
$SendUpdateButton.UseVisualStyleBackColor = $True  
$SendUpdateButton.add\_Click($SendUpdateButton\_OnClick)

$SendUpdateForm.Controls.Add($SendUpdateButton)

$UpdateTextBox.DataBindings.DefaultDataSourceUpdateMode = 0  
$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 35  
$System\_Drawing\_Point.Y = 135  
$UpdateTextBox.Location = $System\_Drawing\_Point  
$UpdateTextBox.Multiline = $True  
$UpdateTextBox.Name = "UpdateTextBox"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 103  
$System\_Drawing\_Size.Width = 290  
$UpdateTextBox.Size = $System\_Drawing\_Size  
$UpdateTextBox.TabIndex = 3

$SendUpdateForm.Controls.Add($UpdateTextBox)

$UpdateLabel.DataBindings.DefaultDataSourceUpdateMode = 0

$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 35  
$System\_Drawing\_Point.Y = 110  
$UpdateLabel.Location = $System\_Drawing\_Point  
$UpdateLabel.Name = "UpdateLabel"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 22  
$System\_Drawing\_Size.Width = 359  
$UpdateLabel.Size = $System\_Drawing\_Size  
$UpdateLabel.TabIndex = 2  
$UpdateLabel.Text = "Please enter the information to be sent to intended recipient:"

$SendUpdateForm.Controls.Add($UpdateLabel)

$EmailToTextBox.DataBindings.DefaultDataSourceUpdateMode = 0  
$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 35  
$System\_Drawing\_Point.Y = 54  
$EmailToTextBox.Location = $System\_Drawing\_Point  
$EmailToTextBox.Name = "EmailToTextBox"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 20  
$System\_Drawing\_Size.Width = 290  
$EmailToTextBox.Size = $System\_Drawing\_Size  
$EmailToTextBox.TabIndex = 1

$SendUpdateForm.Controls.Add($EmailToTextBox)

$EMailToLabel.DataBindings.DefaultDataSourceUpdateMode = 0

$System\_Drawing\_Point = New-Object System.Drawing.Point  
$System\_Drawing\_Point.X = 35  
$System\_Drawing\_Point.Y = 27  
$EMailToLabel.Location = $System\_Drawing\_Point  
$EMailToLabel.Name = "EMailToLabel"  
$System\_Drawing\_Size = New-Object System.Drawing.Size  
$System\_Drawing\_Size.Height = 24  
$System\_Drawing\_Size.Width = 439  
$EMailToLabel.Size = $System\_Drawing\_Size  
$EMailToLabel.TabIndex = 0  
$EMailToLabel.Text = "Please enter the email address of the intended recipient:"

$SendUpdateForm.Controls.Add($EMailToLabel)

#endregion Generated Form Code

#Save the initial state of the form  
$InitialFormWindowState = $SendUpdateForm.WindowState  
#Init the OnLoad event to correct the initial state of the form  
$SendUpdateForm.add\_Load($OnLoadForm\_StateCorrection)  
#Show the Form  
$SendUpdateForm.ShowDialog()| Out-Null

} #End Function

#Call the Function  
GenerateForm  
[/code]

[/code]

Ok, so that is the PowerShell side done. Now, it is time to create the console task. This is a fairly straight forward exercise. There are only a few tips I would like to share. I used a shared folder for the scripts and then mapped the console task to the shared folder. [Netivia Consulting][5] has a great idea as well, I will be changing to [PowerShell Remoting][6] soon, great idea!!!!!

I have configured the PowerShell script to use a parameter, the ID of the Work Item, this is very easy to configure and ensure that the parameter is passed on. See below.

![][7] 

You will see that I used the &#8220;Log in action log when this task is run&#8221;. That is where the Write-host in the PowerShell script becomes handy, the write-host lines are added to the Action Log.

Please feel free to use and modify to meet your needs.

[(E-Mail me)][8]

![][9] 

Follow me.

![][10] Facebook (Personal)

![][11] Twitter (Personal & System Centre)

![][12] Twitter (System Centre Focused)

 [1]: http://www.google.co.za/url?sa=t&rct=j&q=&esrc=s&frm=1&source=web&cd=2&cad=rja&ved=0CDcQFjAB&url=http%3A%2F%2Ftechnet.microsoft.com%2Fen-us%2Flibrary%2Fbb978526.aspx&ei=n9GFUqzuA82Q7Aa0iIDIDQ&usg=AFQjCNEvIcgZxlDObkkS_7SVJv5EkLQnbg&sig2=BcRws6Y5cggElMJcFb1nnQ&bvm=bv.56643336,d.d2k
 [2]: /wp-content/uploads/2013/11/111913_0952_sendemailto1.png
 [3]: http://www.sapien.com/blog/2009/07/07/new-version-of-primalforms-community-edition-available/
 [4]: http://gallery.technet.microsoft.com/Simple-Send-email-to-3rd-2e85e07a
 [5]: http://www.netiviaconsulting.com
 [6]: http://www.netiviaconsulting.com/2013/09/24/console-tasks-powershell-remoting-allowing-smlets-and-ps1-files-to-remain-on-the-scsm-server-only-but-executable-from-all-analyst-consoles/
 [7]: /wp-content/uploads/2013/11/111913_0952_sendemailto2.png
 [8]: mailto:systemcenterguyza@live.com
 [9]: /wp-content/uploads/2013/11/111913_0952_sendemailto3.png
 [10]: /wp-content/uploads/2013/11/111913_0952_sendemailto4.jpg
 [11]: /wp-content/uploads/2013/11/111913_0952_sendemailto5-1.jpg
 [12]: /wp-content/uploads/2013/11/111913_0952_sendemailto6-1.jpg